{"version":3,"sources":["webpack:///./www/src/js/input-file.js","webpack:///./www/src/js/input-file/error-messages-template.html","webpack:///./www/src/js/input-file/progress-template.html","webpack:///./www/src/js/input-file/upload-template.html","webpack:///./www/src/js/input-file/value-template.html","webpack:///./www/src/js/input-file/upload-view.js"],"names":["InputFile","selector","length","$","each","index","button","input","view","data","val","url","setValueInput","setFileThumbnail","setFileUrl","renderFileValue","document","on","e","preventDefault","setFileInputName","setActionUrl","body","appendChild","render","el","module","exports","uploadTemplate","_","template","valueTemplate","progressTemplate","errorMessagesTemplate","UploadView","Backbone","View","extend","events","$valueInput","$wrapper","parent","fileInputName","fileThumbnail","fileUrl","actionUrl","$el","html","find","click","thumbnail","clearStatusUi","append","bind","renderErrorMessages","messages","renderProgressBar","remove","handleFileSelected","files","target","FormData","file","attr","ajax","type","cache","dataType","processData","contentType","success","response","result","value","trigger","error"],"mappings":"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","file":"2.js","sourcesContent":["import UploadView from './input-file/upload-view';\n\nclass InputFile {\n    constructor(selector = '.btn-input-file') {\n        if (!selector.length) {\n            selector = '.btn-input-file'\n        }\n\n        // Render initial input state\n        $(selector).each(\n            function (index, button) {\n                var input,\n                    view = new UploadView();\n\n                button = $(button);\n                input  = $(button.data('value-input'));\n\n                if (input.val()) {\n                    var url = input.val();\n                    if (button.data('file-url')) {\n                        url = button.data('file-url');\n                    }\n\n                    view\n                        .setValueInput(input)\n                        .setFileThumbnail(button.data('file-thumbnail'))\n                        .setFileUrl(button.data('file-url'))\n                        .renderFileValue(url, button.data('file-thumbnail'));\n                }\n            }\n        );\n\n        // Handle attempt to upload a file\n        $(document).on(\n            'click',\n            selector,\n            function (e) {\n                var view   = new UploadView(),\n                    button = $(this);\n\n                e.preventDefault();\n\n                view\n                    .setValueInput($(button.data('value-input')))\n                    .setFileInputName(button.data('file-input-name'))\n                    .setActionUrl(button.data('action-url'));\n\n                document.body.appendChild(view.render().el);\n            }\n        );\n    }\n}\n\nexport default InputFile;\n\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file.js","module.exports = \"<div class=\\\"input-file-status-ui\\\">\\n    <div class=\\\"alert alert-danger\\\" role=\\\"alert\\\">\\n        <% _.each(messages, function (message) { %>\\n        <div><%- message %></div>\\n        <% }); %>\\n    </div>\\n</div>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/error-messages-template.html","module.exports = \"<div class=\\\"input-file-status-ui\\\">\\n    <div class=\\\"progress\\\">\\n        <div class=\\\"progress-bar progress-bar-striped active\\\" role=\\\"progressbar\\\" aria-valuenow=\\\"45\\\" aria-valuemin=\\\"0\\\" aria-valuemax=\\\"100\\\" style=\\\"width: 100%\\\">\\n            <span class=\\\"sr-only\\\">Loading...</span>\\n        </div>\\n    </div>\\n    <div class=\\\"progress-text text-muted\\\">Loading.  Please wait...</div>\\n</div>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/progress-template.html","module.exports = \"<form class=\\\"input-file-upload-form\\\" enctype=\\\"multipart/form-data\\\" action=\\\"\\\" method=\\\"POST\\\">\\n    <input class=\\\"input-file-uploader\\\" type=\\\"file\\\" name=\\\"<%- fileInputName %>\\\" />\\n</form>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/upload-template.html","module.exports = \"<div class=\\\"input-file-status-ui\\\">\\n    <% if (thumbnail) { %>\\n    <div class=\\\"panel panel-default\\\">\\n        <div class=\\\"panel-body\\\">\\n            <a target=\\\"_blank\\\" href=\\\"<%- url %>\\\">\\n                <div class=\\\"thumbnail\\\">\\n                    <img src=\\\"<%- thumbnail %>\\\" />\\n                </div>\\n\\n                <span class=\\\"glyphicon glyphicon-file\\\"></span>\\n                <%- url.split('/').pop() %>\\n            </a>\\n        </div>\\n    </div>\\n    <% } else { %>\\n    <a target=\\\"_blank\\\" href=\\\"<%- url %>\\\">\\n        <span class=\\\"glyphicon glyphicon-file\\\"></span>\\n        <%- url.split('/').pop() %>\\n    </a>\\n    <% } %>\\n\\n\\n    <div class=\\\"btn-group btn-group-justified\\\" role=\\\"group\\\">\\n        <div class=\\\"btn-group\\\" role=\\\"group\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-default btn-xs btn-remove\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span> Remove</button>\\n        </div>\\n        <!--\\n        <div class=\\\"btn-group\\\" role=\\\"group\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-default btn-xs btn-copy\\\"><span class=\\\"glyphicon glyphicon-copy\\\"></span> Copy</button>\\n        </div>\\n        -->\\n    </div>\\n</div>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/value-template.html","import templateHtml from './upload-template.html';\nimport valueTemplateHtml from './value-template.html';\nimport progressTemplateHtml from './progress-template.html';\nimport errorMessagesTemplateHtml from './error-messages-template.html';\n\nvar uploadTemplate        = _.template(templateHtml),\n    valueTemplate         = _.template(valueTemplateHtml),\n    progressTemplate      = _.template(progressTemplateHtml),\n    errorMessagesTemplate = _.template(errorMessagesTemplateHtml);\n\nvar UploadView = Backbone.View.extend({\n    events: {\n        'change input': 'handleFileSelected'\n    },\n\n    setValueInput: function ($valueInput) {\n        this.$valueInput = $valueInput;\n        this.$wrapper    = $valueInput.parent();\n\n        return this;\n    },\n\n    setFileInputName: function (fileInputName) {\n        this.fileInputName = fileInputName;\n\n        return this;\n    },\n\n    setFileThumbnail: function (fileThumbnail) {\n        this.fileThumbnail = fileThumbnail;\n        return this;\n    },\n\n    setFileUrl: function (fileUrl) {\n        this.fileUrl = fileUrl;\n        return this;\n    },\n\n    setActionUrl: function(actionUrl) {\n        this.actionUrl = actionUrl;\n\n        return this;\n    },\n\n    render: function () {\n        this.$el.html(\n            uploadTemplate(\n                {\n                    fileInputName: this.fileInputName\n                }\n            )\n        );\n\n        this.$el.find('input').click();\n\n        if (this.$valueInput.val()) {\n            var url = this.$valueInput.val();\n            if (this.fileUrl) {\n                url = this.fileUrl;\n            }\n\n            this.renderFileValue(url, this.fileThumbnail);\n        }\n\n        return this;\n    },\n\n    renderFileValue: function (url, thumbnail) {\n        this.clearStatusUi();\n\n        // @todo Refactor value UI into a sub-view so we can use Backbone event delegation for the buttons\n        this.$wrapper.find('.value-wrapper').append(\n            valueTemplate(\n                {\n                    url: url,\n                    thumbnail: thumbnail\n                }\n            )\n        );\n\n        this.$wrapper.on(\n            'click',\n            '.btn-remove',\n            _.bind(\n                function (e) {\n                    e.preventDefault();\n                    this.$valueInput.val('');\n                    this.clearStatusUi();\n                },\n                this\n            )\n        );\n\n        this.$wrapper.on(\n            'click',\n            '.btn-copy',\n            _.bind(\n                function (e) {\n                    e.preventDefault();\n                    this.$valueInput.val('');\n                },\n                this\n            )\n        );\n    },\n\n    renderErrorMessages: function (messages) {\n        this.clearStatusUi();\n\n        this.$wrapper.append(\n            errorMessagesTemplate(\n                {\n                    messages: messages\n                }\n            )\n        )\n    },\n\n    renderProgressBar: function () {\n        this.clearStatusUi();\n\n        this.$wrapper.find('.value-wrapper').append(\n            progressTemplate(\n                {\n\n                }\n            )\n        );\n    },\n\n    clearStatusUi: function () {\n        this.$wrapper.find('.input-file-status-ui').remove();\n    },\n\n    handleFileSelected: function (e) {\n        var files = e.target.files,\n            data  = new FormData();\n\n        _.each(\n            files,\n            function (file) {\n                data.append(this.$el.find('input').attr('name'), file);\n            },\n            this\n        );\n\n        this.renderProgressBar();\n\n        $.ajax({\n            url: this.actionUrl,\n            type: 'POST',\n            data: data,\n            cache: false,\n            dataType: 'json',\n            processData: false,\n            contentType: false,\n            success: _.bind(\n                function (response) {\n                    if (!response || 'success' !== response.result) {\n                        this.renderErrorMessages(response.messages);\n                    } else {\n                        this.$valueInput.val(response.value).trigger('change');\n\n                        this.renderFileValue(response.url, response.thumbnail);\n                    }\n                },\n                this\n            ),\n            error: _.bind(\n                function () {\n                    this.renderErrorMessages(\n                        ['There was an error uploading the selected file.  Please try again.']\n                    );\n                },\n                this\n            )\n        });\n    }\n});\n\nexport default UploadView;\n\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/upload-view.js"],"sourceRoot":""}