{"version":3,"sources":["webpack:///./www/src/js/input-file.js","webpack:///./www/src/js/input-file/error-messages-template.html","webpack:///./www/src/js/input-file/progress-template.html","webpack:///./www/src/js/input-file/upload-template.html","webpack:///./www/src/js/input-file/value-template.html","webpack:///./www/src/js/input-file/upload-view.js"],"names":["InputFile","selector","length","$","each","index","button","input","view","data","val","url","setValueInput","setFileThumbnail","setFileUrl","renderFileValue","document","on","e","preventDefault","setFileInputName","setActionUrl","body","appendChild","render","el","module","exports","uploadTemplate","_","template","valueTemplate","progressTemplate","errorMessagesTemplate","UploadView","Backbone","View","extend","events","$valueInput","$wrapper","parent","fileInputName","fileThumbnail","fileUrl","actionUrl","$el","html","find","click","thumbnail","clearStatusUi","append","bind","renderErrorMessages","messages","renderProgressBar","remove","handleFileSelected","files","target","FormData","file","attr","ajax","type","cache","dataType","processData","contentType","success","response","result","value","trigger","error"],"mappings":"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","file":"2.js","sourcesContent":["import UploadView from './input-file/upload-view';\n\nclass InputFile {\n    constructor(selector = '.btn-input-file') {\n        if (!selector.length) {\n            selector = '.btn-input-file'\n        }\n\n        // Render initial input state\n        $(selector).each(\n            function (index, button) {\n                var input,\n                    view = new UploadView();\n\n                button = $(button);\n                input  = $(button.data('value-input'));\n\n                if (input.val()) {\n                    var url = input.val();\n                    if (button.data('file-url')) {\n                        url = button.data('file-url');\n                    }\n\n                    view\n                        .setValueInput(input)\n                        .setFileThumbnail(button.data('file-thumbnail'))\n                        .setFileUrl(button.data('file-url'))\n                        .renderFileValue(url, button.data('file-thumbnail'));\n                }\n            }\n        );\n\n        // Handle attempt to upload a file\n        $(document).on(\n            'click',\n            selector,\n            function (e) {\n                var view   = new UploadView(),\n                    button = $(this);\n\n                e.preventDefault();\n\n                view\n                    .setValueInput($(button.data('value-input')))\n                    .setFileInputName(button.data('file-input-name'))\n                    .setActionUrl(button.data('action-url'));\n\n                document.body.appendChild(view.render().el);\n            }\n        );\n    }\n}\n\nexport default InputFile;\n\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file.js","module.exports = \"<div class=\\\"input-file-status-ui\\\">\\n    <div class=\\\"alert alert-danger\\\" role=\\\"alert\\\">\\n        <% _.each(messages, function (message) { %>\\n        <div><%- message %></div>\\n        <% }); %>\\n    </div>\\n</div>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/error-messages-template.html","module.exports = \"<div class=\\\"input-file-status-ui\\\">\\n    <div class=\\\"progress\\\">\\n        <div class=\\\"progress-bar progress-bar-striped active\\\" role=\\\"progressbar\\\" aria-valuenow=\\\"45\\\" aria-valuemin=\\\"0\\\" aria-valuemax=\\\"100\\\" style=\\\"width: 100%\\\">\\n            <span class=\\\"sr-only\\\">Loading...</span>\\n        </div>\\n    </div>\\n    <div class=\\\"progress-text text-muted\\\">Loading.  Please wait...</div>\\n</div>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/progress-template.html","module.exports = \"<form class=\\\"input-file-upload-form\\\" enctype=\\\"multipart/form-data\\\" action=\\\"\\\" method=\\\"POST\\\">\\n    <input class=\\\"input-file-uploader\\\" type=\\\"file\\\" name=\\\"<%- fileInputName %>\\\" />\\n</form>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/upload-template.html","module.exports = \"<div class=\\\"input-file-status-ui\\\">\\n    <% if (thumbnail) { %>\\n    <div class=\\\"panel panel-default\\\">\\n        <div class=\\\"panel-body\\\">\\n            <a target=\\\"_blank\\\" href=\\\"<%- url %>\\\">\\n                <div class=\\\"thumbnail\\\">\\n                    <img src=\\\"<%- thumbnail %>\\\" />\\n                </div>\\n\\n                <span class=\\\"glyphicon glyphicon-file\\\"></span>\\n                <%- url.split('/').pop() %>\\n            </a>\\n        </div>\\n    </div>\\n    <% } else { %>\\n    <a target=\\\"_blank\\\" href=\\\"<%- url %>\\\">\\n        <span class=\\\"glyphicon glyphicon-file\\\"></span>\\n        <%- url.split('/').pop() %>\\n    </a>\\n    <% } %>\\n\\n\\n    <div class=\\\"btn-group btn-group-justified\\\" role=\\\"group\\\">\\n        <div class=\\\"btn-group\\\" role=\\\"group\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-default btn-xs btn-remove\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span> Remove</button>\\n        </div>\\n        <!--\\n        <div class=\\\"btn-group\\\" role=\\\"group\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-default btn-xs btn-copy\\\"><span class=\\\"glyphicon glyphicon-copy\\\"></span> Copy</button>\\n        </div>\\n        -->\\n    </div>\\n</div>\\n\"\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/value-template.html","import templateHtml from './upload-template.html';\nimport valueTemplateHtml from './value-template.html';\nimport progressTemplateHtml from './progress-template.html';\nimport errorMessagesTemplateHtml from './error-messages-template.html';\n\nvar uploadTemplate        = _.template(templateHtml),\n    valueTemplate         = _.template(valueTemplateHtml),\n    progressTemplate      = _.template(progressTemplateHtml),\n    errorMessagesTemplate = _.template(errorMessagesTemplateHtml);\n\nvar UploadView = Backbone.View.extend({\n    events: {\n        'change input': 'handleFileSelected'\n    },\n\n    setValueInput: function ($valueInput) {\n        this.$valueInput = $valueInput;\n        this.$wrapper    = $valueInput.parent();\n\n        return this;\n    },\n\n    setFileInputName: function (fileInputName) {\n        this.fileInputName = fileInputName;\n\n        return this;\n    },\n\n    setFileThumbnail: function (fileThumbnail) {\n        this.fileThumbnail = fileThumbnail;\n        return this;\n    },\n\n    setFileUrl: function (fileUrl) {\n        this.fileUrl = fileUrl;\n        return this;\n    },\n\n    setActionUrl: function(actionUrl) {\n        this.actionUrl = actionUrl;\n\n        return this;\n    },\n\n    render: function () {\n        this.$el.html(\n            uploadTemplate(\n                {\n                    fileInputName: this.fileInputName\n                }\n            )\n        );\n\n        this.$el.find('input').click();\n\n        if (this.$valueInput.val()) {\n            var url = this.$valueInput.val();\n            if (this.fileUrl) {\n                url = this.fileUrl;\n            }\n\n            this.renderFileValue(url, this.fileThumbnail);\n        }\n\n        return this;\n    },\n\n    renderFileValue: function (url, thumbnail) {\n        this.clearStatusUi();\n\n        // @todo Refactor value UI into a sub-view so we can use Backbone event delegation for the buttons\n        this.$wrapper.find('.value-wrapper').append(\n            valueTemplate(\n                {\n                    url: url,\n                    thumbnail: thumbnail\n                }\n            )\n        );\n\n        this.$wrapper.on(\n            'click',\n            '.btn-remove',\n            _.bind(\n                function (e) {\n                    e.preventDefault();\n                    this.$valueInput.val('');\n                    this.clearStatusUi();\n                },\n                this\n            )\n        );\n\n        this.$wrapper.on(\n            'click',\n            '.btn-copy',\n            _.bind(\n                function (e) {\n                    e.preventDefault();\n                    this.$valueInput.val('');\n                },\n                this\n            )\n        );\n    },\n\n    renderErrorMessages: function (messages) {\n        this.clearStatusUi();\n\n        this.$wrapper.append(\n            errorMessagesTemplate(\n                {\n                    messages: messages\n                }\n            )\n        )\n    },\n\n    renderProgressBar: function () {\n        this.clearStatusUi();\n\n        this.$wrapper.find('.value-wrapper').append(\n            progressTemplate(\n                {\n\n                }\n            )\n        );\n    },\n\n    clearStatusUi: function () {\n        this.$wrapper.find('.input-file-status-ui').remove();\n    },\n\n    handleFileSelected: function (e) {\n        var files = e.target.files,\n            data  = new FormData();\n\n        _.each(\n            files,\n            function (file) {\n                data.append(this.$el.find('input').attr('name'), file);\n            },\n            this\n        );\n\n        this.renderProgressBar();\n\n        $.ajax({\n            url: this.actionUrl,\n            type: 'POST',\n            data: data,\n            cache: false,\n            dataType: 'json',\n            processData: false,\n            contentType: false,\n            success: _.bind(\n                function (response) {\n                    if (!response || 'success' !== response.result) {\n                        this.renderErrorMessages(response.messages);\n                    } else {\n                        this.$valueInput.val(response.value).trigger('change');\n\n                        this.renderFileValue(response.url, response.thumbnail);\n                    }\n                },\n                this\n            ),\n            error: _.bind(\n                function () {\n                    this.renderErrorMessages(\n                        ['There was an error uploading the selected file.  Please try again.']\n                    );\n                },\n                this\n            )\n        });\n    }\n});\n\nexport default UploadView;\n\n\n\n// WEBPACK FOOTER //\n// ./www/src/js/input-file/upload-view.js"],"sourceRoot":""}